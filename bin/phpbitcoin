#!/usr/bin/env php
<?php
    if(count($argv) == 1)
        {
            echo "
  _____  _    _ _____  ____  _ _            _
 |  __ \\| |  | |  __ \\|  _ \\(_) |          (_)
 | |__) | |__| | |__) | |_) |_| |_ ___ ___  _ _ __
 |  ___/|  __  |  ___/|  _ <| | __/ __/ _ \\| | '_ \\
 | |    | |  | | |    | |_) | | || (_| (_) | | | | |
 |_|    |_|  |_|_|    |____/|_|\\__\\___\\___/|_|_| |_|

        ";
        echo "\n\nPHPBitcoin\n";
        echo "======================================\n\n";
        echo "Usage: ./phpbitcoin command\n\n";
        echo " \n";
        exit;
    }

    require_once('../vendor/autoload.php');

    echo "\n";

    use Del\Bitcoin;
    use GuzzleHttp\Exception\RequestException;

    try {
        $btc = new Bitcoin([
            'username' => 'phpbitcoin',
            'password' => 'COMPLETELYrandomPASSWORD',
            'host' => '127.0.0.1',
            'port' => '18332',
            'protocol' => 'http',
        ]);
        $add1 = json_decode($btc->getWalletApi()->getNewAddress(),true)['result'];
        $add2 = json_decode($btc->getWalletApi()->getNewAddress(),true)['result'];
        echo $btc->getWalletApi()->sendMany('',
            [
                $add1 => 100,
                $add2 => 100,
            ]
            ,1,'this will fail, we aint got the funds'
        );
    }
    catch (RequestException $e) {
        echo "There was a problem. \n".$e->getMessage()."\n\n";
        echo $e->getRequest()->getBody() . "\n";
        echo $e->hasResponse() ? $e->getResponse()->getBody() . "\n" : null;
    }
    echo "\n";